<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: dom.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: dom.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>define(['Q','utils','support'], function(Q, utils, support){
    "use strict";

    /**
     * dom工具模块
     * @module dom
     * @requires Q
     * @requires utils
     */
    var dom = Q.dom = {};

    dom.getDocument = function(ele) {
        return ele.ownerDocument || ele;
    }

    /**
     * 返回两个节点的位置关系
     * @method position
     * @param node1
     * @param node2
     * @returns {number}
     */
    dom.position = function(node1, node2){
        // 如果两个节点是同一个节点
        if (node1 === node2) {
            return 0;
        }
        var node,
            parents1 = [node1],
            parents2 = [node2];
        node = node1;
        while (node = node.parentNode) {
            // 如果nodeB是nodeA的祖先节点
            if (node === node2) {
                return 10;
            }
            parents1.push(node);
        }
        node = node2;
        while (node = node.parentNode) {
            // 如果nodeA是nodeB的祖先节点
            if (node === node1) {
                return 20;
            }
            parents2.push(node);
        }
        /**
         * 反转路径，让其从html开始
         * @example parents1 [html,body,div#container,div#node1,div#node11]
         *          parents2 [html,body,div#container,div#node2,div#node21]
         */
        parents1.reverse();
        parents2.reverse();
        if (parents1[0] !== parents2[0]) {
            return 1;
        }
        var i = -1;
        /**
         * 找出包含node1,node2最近的共同祖先的兄弟节点
         */
        while (i++, parents1[i] === parents2[i]) {
        }
        node1 = parents1[i];
        node2 = parents2[i];
        /**
         * 判断包含node1,node2兄弟节点的位置关系
         */
        while (node1 = node1.nextSibling) {
            if (node1 === node2) {
                return 4
            }
        }
        return  2;
    }

    var html5NodeNames = "abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer" +
           "header|hgroup|mark|meter|nav|output|progress|section|summary|time|video";
    var rhtml = /&lt;|&amp;#?\w+;/;

    /**
     * @method createSafeFragment
     * 创建一个可以正确渲染html标签的DocumentFragment
     * @return {DocumentFragment}
     */
    var createSafeFragment = dom.createSafeFragment = function() {
        var list = html5NodeNames.split('|'),
            safeFrag = document.createDocumentFragment();
        /**
         * IE &lt;= 8 DocumentFragment才有createElement方法
         */
        if (safeFrag.createElement) {//通过创建Html标签,教会IE&lt;8的游览器学会渲染html5元素
            while ( list.length ) {
                safeFrag.createElement(list.pop());
            }
        }
        return safeFrag;
    }

    var wrapMap = {
        option: [1, "&lt;select multiple='multiple'>", "&lt;/select>"],
        legend: [1, "&lt;fieldset>", "&lt;/fieldset>"],
        area: [1, "&lt;map>", "&lt;/map>"],
        param: [1, "&lt;object>","&lt;/object>"],
        thead: [1, "&lt;table>","&lt;/table>"],
        tr: [2, "&lt;table>&lt;tbody>", "&lt;/tbody>&lt;/table>"],
        col: [ 2, "&lt;table>&lt;tbody>&lt;/tbody>&lt;colgroup>", "&lt;/colgroup>&lt;/table>" ],
        td: [ 3, "&lt;table>&lt;tbody>&lt;tr>", "&lt;/tr>&lt;/tbody>&lt;/table>" ],
        /**
         * 包裹一个字符紧挨着的div(X&lt;div>{script|style|link|htmlTags})可以让IE6-8可以正确序列化script、style、link或者任何html5标签
         */
        _default: support.htmlSerialize ? [0, "", ""] : [1, "X&lt;div>", "&lt;/div>"]
    }
    wrapMap["optgroup"] = wrapMap.option;
    wrapMap["tbody"] = wrapMap["tfoot"] = wrapMap["colgroup"] = wrapMap["caption"] = wrapMap.thead;
    wrapMap["th"] = wrapMap.td;

    var rtagName = /&lt;([\w:]+)>/,
        rleadingWhitespace = /^\s+/,
        rselfClosedTag = /&lt;(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi;
    /**
     * 将html字符串转换为DOM节点
     * @method html2DOM
     * @param {string} htmlStr html字符串
     * @returns {Array}
     */
    dom.html2DOM = function(htmlStrs) {
        var eles = [];
        var DOC = self.document;
        if (utils.isString(htmlStrs)) {
            htmlStrs = [htmlStrs];
        }
        utils.each(htmlStrs, function(htmlStr){
            if (!rhtml.test(htmlStr)) { //没有标签或特征直接生成textNode
                eles.push(DOC.createTextNode(htmlStr));
            } else {
                var fragment = createSafeFragment(),
                    tagName = (rtagName.exec(htmlStr) || ['', ''])[1],
                    wrapper = wrapMap[tagName] || wrapMap._default;

                var div = fragment.appendChild(document.createElement('div'));
                div.innerHTML = wrapper[1] + htmlStr.replace(rselfClosedTag, "&lt;$1>&lt;/$2>") + wrapper[2];
                var ele = div.firstChild;

                var wrapperDeeps = wrapper[0];
                while(wrapperDeeps--) {
                    ele = ele.lastChild;
                }
                if (!support.leadingWhitespac &amp;&amp; rleadingWhitespace.test(htmlStr)) {
                    eles.push(DOC.createTextNode(rleadingWhitespace.exec(htmlStr)[0]));
                }

                eles.push(ele);
            }
        });
        return eles;
    }

    return dom;
});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Modules</h3><ul><li><a href="module-ajax.html">ajax</a></li><li><a href="module-dom.html">dom</a></li><li><a href="module-support.html">support</a></li><li><a href="module-utils.html">utils</a></li></ul><h3>Global</h3><ul><li><a href="global.html#isArray">isArray</a></li><li><a href="global.html#isFunction">isFunction</a></li><li><a href="global.html#isNumber">isNumber</a></li><li><a href="global.html#isObject">isObject</a></li><li><a href="global.html#isRegExp">isRegExp</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha10</a> on Wed Nov 19 2014 19:40:04 GMT+0800 (中国标准时间)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
